<!-- snippets/theme__scripts.liquid -->
{% comment %}
  Site wide variables and JavaScript.

  Usage:
    {% render 'theme__scripts' %}

  Globals:
    - settings.cart_behavior: set the cart behavior to either 'drawer' or 'alert'

  Possible enhancements:
    - Prepare help docs on editing JavaScript and include build files.

  Recommendations:
    - Build files can be requested from theme support - hello@brickspacelab.com.
{% endcomment %}

<script>
  window.__initialData = window.__initialData || {};
  Object.assign(window.__initialData, {

    // Color
    // - Adjust the header when using a banner with an overlay + when using a section with color fade
    body_background_color: '#fff', // {string} Background color of the body
    body_text_color: '#fff', // {string} Text color of the body

    // Scroll
    is_scrolled: false, // {boolean} To toggle check direction of scroll
    is_scrolled_up: true, // {boolean} To toggle check if within 300px of top
    prev_scroll_pos: 0, // {number} Pprevious scroll position of the page
    show_scroll_up: false, // {boolean} To show the 'back to top' button
    enable_body_scrolling: true, // {boolean} To enable or disable body scrolling

    // Audio
    click_audio: '{{ 'click.wav' | asset_url }}', // {string} URL for click sound
    success_audio: '{{ 'success.wav' | asset_url }}', // {string} URL for success sound
    enable_audio: {{ settings.enable_audio }}, // {boolean} To enable or disable audio

    // Error
    error_alert: false, // {boolean} To show the alert
    error_message: '', // {string} Error message

    // Discount
    discount_text: '', // {string} Text for the discount
    discount_code: '', // {string} Code for the discount

    // Pagination
    pagination_loading: false, // {boolean} To show loading state in pagination

    // Recent products
    recent_products: localStorage.getItem("recentlyViewedProducts") ? JSON.parse(localStorage.getItem("recentlyViewedProducts")) : [], // {array} Recently viewed products

    // Overlays
    age_overlay: localStorage.getItem("ageConfirmed") ? true : false, // {boolean} To toggle the age overlay
    audio_overlay: false, // {boolean} To toggle the audio settings overlay
    discount_alert: false, // {boolean} To toggle the discount overlay
    filter_overlay: false, // {boolean} To toggle the filter overlay
    localization_overlay: false, // {boolean} To toggle the localization overlay
    quick_edit_handle: '', // {string} Set to the product handle of the product being edited
    cart_drawer_style: '{{ settings.cart_drawer_style }}', // {string} Style of the cart drawer

    // Header
    hide_header: false, // {boolean} To hide the header
    header_group_height: 80, // {number} Height of the header group
    header_bar_height: 60, // {number} Height of the header bar
    filter_group_height: 80, // {number} Height of the filter group

    // Menu
    menu_drawer: window.innerWidth > 1024, // {boolean} To toggle the menu drawer
    menu_sidebar: false, // {boolean} To toggle the menu sidebar
    menu_nested: false, // {boolean} To check if the menu is nested

    // Account
    account_drawer: false, // {boolean} To toggle the account drawer

    // Product
    sticky_bar_height_left: 0, // {number} Height of the sticky bar
    sticky_bar_height_right: 0, // {number} Height of the sticky bar
    reset_product_zindex: false, // {boolean} To reset the z-index of the product columns

    // Cart
    cart_drawer: false, // {boolean} To toggle the cart drawer
    cart_alert: false, // {boolean} To show the cart alert
    cart_loading: false, // {boolean} To check if the cart is loading
    cart_behavior_desktop: '{{ settings.cart_behavior_desktop }}', // {string} Behavior of the cart on desktop
    cart_behavior_mobile: '{{ settings.cart_behavior_mobile }}', // {string} Behavior of the cart on mobile
    cart_alert_timeout: null, // {number} Timeout for the cart alert
    cart: {
      items: [
        {% for item in cart.items %}
          {
            variant_id: {{ item.variant_id }}, // {number} Variant ID of the item
            final_price: {{ item.final_price }}, // {number} Final price of the item
            quantity: {{ item.quantity }}, // {number} Quantity of the item
            unit_price: 0, // {number} Unit price of the item
            unit_price_measurement: {} // {string} Measurement of the unit price
          },
        {% endfor %}
      ],
      note: '{{ cart.note }}', // {string} Note for the cart
      item_count: {{ cart.item_count }}, // {number} Count of items in the cart
      total_price: {{ cart.total_price }}, // {number} Total price of the cart
      original_total_price: {{ cart.original_total_price }}, // {number} Original total price of the cart
      total_discount: {{ cart.total_discount }}, // {number} Total discount of the cart
      progress_bar_delay_width: 0, // {number} Width of the delay bar in cart alerts
      progress_bar_remaining: 0, // {number} Remaining amount - e.g. 'Spend X more for free shipping'
      progress_bar_percent: '0%', // {string} Percent to reaching free shipping
      variantMap: {
        {% for item in cart.items %}
          {{ item.variant_id }}: {
            variant_id: {{ item.variant_id }},
            key: '{{ item.key }}',
            quantity: {{ item.quantity }},
            line_price: {{ item.line_price }},
            final_line_price: {{ item.final_line_price }},
            product_id: {{ item.product_id }},
            product_title: '{{ item.product_title | escape }}',
            variant_title: '{{ item.variant_title | escape }}',
            url: '{{ item.url }}',
            image: '{{ item.image | image_url: width: 200 }}',
            sku: '{{ item.sku }}',
            price: {{ item.price }},
            original_price: {{ item.original_price }},
            discounted_price: {{ item.discounted_price }},
            original_line_price: {{ item.original_line_price }},
            total_discount: {{ item.total_discount }},
            unit_price: {{ item.unit_price | default: 0 }},
            unit_price_measurement: {{ item.unit_price_measurement | default: hash | json }},
            properties: {{ item.properties | default: hash | json }},
            selling_plan_allocation: {{ item.selling_plan_allocation | default: nil | json }},
            discounts: {{ item.discounts | default: array | json }}
          }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      }, // {object} Map of variant IDs to cart items for O(1) lookups
    },

    // Search
    search_drawer: false, // {boolean} To toggle the search drawer
    search_loading: false, // {boolean} To check if the search is loading
    search_term: '', // {string} Term for the search
    search_items: [], // {array} Array of search items
    search_focus_index: '', // {string} Index of the focused search item
    search_focus_url: '', // {string} URL of the focused search item
    search_items_collections: [], // {array} Array of search items in collections
    search_items_pages: [], // {array} Array of search items in pages
    search_items_articles: [], // {array} Array of search items in articles
    search_items_queries: [], // {array} Array of search items in queries

    // Edit
    edit_variant: 0, // {number} Variant ID of old item when editing
    edit_quantity: 0, // {number} Quantity to use when editing

    // Prices
    price_format_with_currency: '{{ shop.money_format }}', // {string} Format for price with currency
    price_format_without_currency: '{{ shop.money_with_currency_format }}', // {string} Format for price without currency
    enable_zeros: {{ settings.enable_zeros }}, // {Boolean} Set to false to hide '.00'
    enable_currency: {{ settings.enable_currency }}, // {Boolean} Set to false to hide 'CAD'

  });
</script>

{% if template.directory == 'customers' %}
  <script src="{{ 'shopify_common.js' | shopify_asset_url }}" defer="defer"></script>
{% endif %}

{% render 'script__localization' %}
{% render 'script__recent-view' %}
{% render 'script__design-mode' %}
