<!-- snippets/component__image.liquid -->
{% comment %}
  Responive image component

  Accepts:
  - image: {Object} Image object to be displayed.
  - max_width: {number} Max width for the image. Default is 100% width.
  - background_class: {string} Classes to set the background of the container.
  - parent_class: {string} Additional classes to add to the parent container.
  - container_class: {string} Additional classes to add to the image container.
  - image_class: {string} Additional classes to add to the image itself.
  - ratio_class: {string} Classes to set the aspect ratio of the image.
  - crop_class: {string} Classes to set object sizing for the image.
  - enable_ratio: {boolean} Whether to enable the default aspect ratio.
  - enable_lazy_load: {boolean} Enable lazy loading for the image. Default is true.

  Globals:
  - settings.enable_animations: {boolean} Determines if animations are enabled.
  - settings.enable_animated_images: {boolean} Determines if animated images are enabled.

  Usage:
    {% render 'component__image',
      image: image,
      max_width: 900,
      background_class: 'color__bg-shade-2',
      parent_class: 'my-class',
      container_class: 'my-class',
      image_class: 'my-class',
      ratio_class: 'aspect-[1/1]',
      crop_class: 'object-cover',
      enable_ratio: true,
      enable_lazy_load: true,
    %}
{% endcomment %}

{% liquid
  assign alt = image.alt | escape

  capture adjusted_image_class
    echo ' animation-500 h-full '
    echo image_class
    echo ' '
    echo crop_class
    unless request.design_mode
      echo ' js-image '
    endunless
  endcapture

  capture loading
    if enable_lazy_load
      echo ' lazy'
    else
      echo ' eager'
    endif
  endcapture
%}

<div
  class="
    relative flex items-center justify-center overflow-clip
    {{ background_class }}
    {{ parent_class }}
    {% unless request.design_mode %}
      js-picture
    {% endunless %}
  "
>
  {% if image != blank %}
    <picture
      class="
        flex w-full items-center justify-center overflow-clip
        {{ ratio_class }}
        {{ container_class }}
      "
      {% if enable_ratio %}
        style="aspect-ratio: {{ image.aspect_ratio }}"
      {% endif %}
    >
      {{
        image
        | image_url: width: max_width
        | image_tag:
          alt: alt,
          class: adjusted_image_class,
          widths: '100,200,300,400,500,600,700,800,1000,1200,1400,1600,1800,5000',
          loading: loading,
          fetchpriority: priority,
          decoding: decoding
      }}
      <canvas
        class="logo-preview_canvas"
        data-media-id="logo-preview_{{ colors_names[forloop.index0] }}"
        data-media-option="{{ colors_names[forloop.index0] }}"
        width="600"
        height="600"
        style="max-width: 100%; display: none;"></canvas>
    </picture>
    {% if request.design_mode != true and settings.enable_animated_images %}
      <img
        class="
          js-placeholder animation-1000 absolute inset-0 h-full blur-lg
          {{ image_class }}
          {{ crop_class }}
        "
        alt="{{ alt }}"
        width="5760"
        height="5760"
        loading="{{ loading }}"
        src="{{ image | image_url: width: 4 }}"
      >
    {% endif %}
  {% endif %}
</div>
