<!-- snippets/script__design-mode.liquid -->
{% comment %}
  This script is used to apply minor changes when using the theme editor. It ensures that overlays will open when they are being edited. For example, when editing the cart drawer, the drawer will be visible in the theme editor.

  Usage:
    {% render 'script__design-mode' %}
{% endcomment %}

{% if request.design_mode %}
  {% comment %} Reset js animations when in design mode {% endcomment %}
  <style>
    .js-animation.opacity-0 {
      opacity: 100 !important;
      filter: blur(0px);
      transform: scale(1);
    }
    .js-image {
      opacity: 100 !important;
      filter: blur(0px);
      transform: scale(1);
    }
    .js-picture {
      animation: none !important;
      filter: blur(0px);
      transform: scale(1);
    }
  </style>

  {% comment %} Open selected sectioin {% endcomment %}
  <script>
    document.addEventListener('shopify:section:select', function (event) {
      const app = document.querySelectorAll('html')[0]._x_dataStack[0];
      if (event.detail.sectionId.includes('theme__cart')) {
        app.closeAccount();
        app.closeSearch();
        app.closeMenu();
        app.openCart();
      }
      if (event.detail.sectionId.includes('theme__account')) {
        app.closeCart();
        app.closeMenu();
        app.closeSearch();
        app.openAccount();
      }
      if (event.detail.sectionId.includes('theme__search')) {
        app.closeCart();
        app.closeMenu();
        app.closeAccount();
        app.openSearch();
      }
      if (event.detail.sectionId.includes('theme__menu')) {
        app.closeCart();
        app.closeAccount();
        app.closeSearch();
        app.openMenu();
      }
    });
  </script>

  {% comment %} Intercom setup {% endcomment %}
  <script>
    window.intercomSettings = {
      api_base: 'https://api-iam.intercom.io',
      app_id: 'fnubgeik',
      Theme_version: 'Keystone v1.4.1',
      Shop_name: '{{ shop.name }}',
      Shop_url: '{{ shop.url }}',
      email: '{{ shop.email }}',
    };
  </script>
  <script>
    (function () {
      var w = window;
      var ic = w.Intercom;
      if (typeof ic === 'function') {
        ic('reattach_activator');
        ic('update', w.intercomSettings);
      } else {
        var d = document;
        var i = function () {
          i.c(arguments);
        };
        i.q = [];
        i.c = function (args) {
          i.q.push(args);
        };
        w.Intercom = i;
        var l = function () {
          var s = d.createElement('script');
          s.type = 'text/javascript';
          s.async = true;
          s.src = 'https://widget.intercom.io/widget/fnubgeik';
          var x = d.getElementsByTagName('script')[0];
          x.parentNode.insertBefore(s, x);
        };
        if (document.readyState === 'complete') {
          l();
        } else if (w.attachEvent) {
          w.attachEvent('onload', l);
        } else {
          w.addEventListener('load', l, false);
        }
      }
    })();
  </script>

  {% comment %} Subscribe to Loops {% endcomment %}
  <script>
    const merchantData = {
      email: '{{ shop.email }}',
      url: '{{ shop.url }}',
      shop: '{{ shop.name }}',
      theme: 'Keystone v1.4.1',
    };
    fetch('https://brickspaceloops.vercel.app/api/updateContact', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(merchantData),
    })
      .then((response) => {
        return response.json();
      })
      .catch((error) => {
        console.error('Error:', error);
      });
  </script>
{% endif %}
