<!-- snippets/component__video.liquid -->
{% comment %}
  Responive video component

  Accepts:
  - video: {Object} video object to be displayed.
  - background_class: {string} Classes to set the background of the container.
  - container_class: {string} Additional classes to add to the video container.
  - video_class: {string} Additional classes to add to the video.
  - enable_custom_controls: {boolean} If set to true, video controls (play, pause, etc.) will be visible.
  - enable_default_controls: {boolean} If set to true, video controls (play, pause, etc.) will be visible.
  - enable_mute_toggle: {boolean} If set to true, provides an option to mute or unmute the video's audio.
  - enable_play_button: {boolean} If set to true, provides a play button to play the video.
  - enable_autoplay: {boolean} If set to true, the video will start playing as soon as it's ready.
  - enable_loop: {boolean} If set to true, the video will loop back to the beginning once finished.
  - enable_play_button_icon: {boolean} If set to true, the play button will display an icon.
  - play_button_text: {string} Text to display on the play button.
  - color_button: {string} Color to set the play button.

  Usage:
    {% render 'component__video',
      video: video,
      background_class: 'color__bg-shade-2',
      container_class: 'my-class',
      video_class: 'my-class',
      enable_custom_controls: true,
      enable_default_controls: true,
      enable_mute_toggle: true,
      enable_play_button: true,
      enable_autoplay: true,
      enable_loop: true,
      enable_play_button_icon: true,
      play_button_text: 'Play video',
      color_button: 'color__text-body'
    %}
{% endcomment %}

<div
  class="
    group/video relative h-full w-full overflow-hidden
    {{ background_class }}
    {{ container_class }}
  "
  style="
    {% if video.aspect_ratio %}
      aspect-ratio:{{ video.aspect_ratio }};
    {% else %}
      aspect-ratio:16/9;
    {% endif %}
  "
  x-data="
    {
      video_muted: true,
      video_playing: {% if enable_autoplay %} true {% else %} false {% endif %}
    }
  "
>
  <video
    class="
      absolute left-0 top-0 h-full w-full
      {{ video_class }}
    "
    style="aspect-ratio:{{ video.aspect_ratio }};"
    muted
    playsinline
    poster="{{ video.preview_image | image_url: width: 1200 }}"
    {% if enable_default_controls %}
      controls="controls"
    {% endif %}
    {% if enable_autoplay %}
      autoplay
    {% endif %}
    {% if enable_loop %}
      loop
    {% endif %}
    x-ref="video"
  >
    {% for source in video.sources %}
      {% # theme-check-disable %}
      <source src="{{ source.url }}" type="{{ source.mime_type }}">
      {% # theme-check-enable %}
    {% endfor %}
  </video>

  {% if enable_custom_controls %}
    <div class="animation-300 absolute left-2 top-2 z-20 flex flex-col gap-2 group-hover/video:opacity-100 md:opacity-50">
      <button
        class="btn btn--plain btn--smaller animation-300 !p-2 hover:opacity-100 group-hover/model:opacity-100"
        title="{{ 'actions.pause' | t }}"
        type="button"
        x-ref="pauseBtn"
        @click.prevent="
          $refs.video.pause();
          video_playing = false;
        "
        x-show="video_playing"
        x-cloak
      >
        {% render 'component__icon', icon: 'pause', size: '16' %}
      </button>
      <button
        class="btn btn--plain btn--smaller animation-300 !p-2 hover:opacity-100 group-hover/model:opacity-100"
        title="{{ 'actions.pause' | t }}"
        type="button"
        x-ref="playBtn"
        @click.prevent="
          $refs.video.play();
          video_playing = true;
        "
        x-show="!video_playing"
        x-cloak
      >
        {% render 'component__icon', icon: 'play', size: '16' %}
      </button>
      {% if enable_mute_toggle %}
        <button
          class="btn btn--plain btn--smaller animation-300 !p-2 hover:opacity-100 group-hover/model:opacity-100"
          title="{{ 'actions.mute' | t }}"
          type="button"
          x-ref="muteBtn"
          @click.prevent="
            $refs.video.muted = true;
            video_muted = true;
          "
          x-show="!video_muted"
          x-cloak
        >
          {% render 'component__icon', icon: 'volume', size: '16' %}
        </button>
        <button
          class="btn btn--plain btn--smaller animation-300 !p-2 hover:opacity-100 group-hover/model:opacity-100"
          title="{{ 'actions.unmute' | t }}"
          type="button"
          x-ref="unmuteBtn"
          @click.prevent="
            $refs.video.muted = false;
            video_muted = false;
          "
          x-show="video_muted"
          x-cloak
        >
          {% render 'component__icon', icon: 'volume-x', size: '16' %}
        </button>
      {% endif %}
    </div>
  {% endif %}

  {% if enable_play_button %}
    <button
      type="button"
      class="absolute bottom-0 top-0 z-10 flex h-full w-full cursor-pointer items-center justify-center overflow-hidden"
      title="{{ play_button_text }}"
      aria-label="{{ play_button_text }}"
      x-ref="playBtn"
      @click.prevent="
        $refs.video.play();
        $refs.video.currentTime = 0;
        $refs.video.controls = true;
        $refs.video.muted = false;
        $refs.playBtn.style.display = 'none';
      "
    >
      {% if play_button_text != blank or enable_play_button_icon %}
        <span
          class="btn absolute {{ color_button }}"
        >
          {% if enable_play_button_icon %}
            {% render 'component__icon', icon: 'play', size: '20' %}
          {% endif %}
          {% if play_button_text != blank %}
            <span
              {% if enable_play_button_icon %}
                class="ml-2"
              {% endif %}
            >
              {{ play_button_text }}
            </span>
          {% endif %}
        </span>
      {% endif %}
    </button>
  {% endif %}
</div>
