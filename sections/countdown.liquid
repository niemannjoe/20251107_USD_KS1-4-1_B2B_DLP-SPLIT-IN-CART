<!-- sections/countdown.liquid -->
{% comment %} 
  A countdown timer used for limited time offers.

  Globals:
  - layout_horizontal: {string} Class string to set horizontal margin.
  - enable_animations: {boolean} Global setting to determine if animations are enabled.
{% endcomment %}

{% unless section.settings.countdown_date == blank %}
  <section 
    id="{{ section.id }}"
    class="
      animation-1000
      {{ section.settings.visibility }}
      {{ section.settings.color_border }}
      {{ section.settings.style_border }}
      {{ section.settings.color_scheme }}
    "
    x-data="{
      expired: false,
      timer: (expiry) => {
        return {
          expiry: expiry,
          remaining:null,
          init() {
            this.setRemaining()
            setInterval(() => {
              this.setRemaining();
            }, 1000);
          },
          setRemaining() {
            const diff = this.expiry - new Date().getTime();
            this.remaining =  parseInt(diff / 1000);
            if (this.remaining < 0) {
              this.expired = true;
            }
          },
          days() {
            return {
              value:this.remaining / 86400,
              remaining:this.remaining % 86400
            };
          },
          hours() {
            return {
              value:this.days().remaining / 3600,
              remaining:this.days().remaining % 3600
            };
          },
          minutes() {
            return {
              value:this.hours().remaining / 60,
              remaining:this.hours().remaining % 60
            };
          },
          seconds() {
            return {
              value:this.minutes().remaining,
            };
          },
          format(value) {
            return (parseInt(value));
          },
          time(){
            return {
              days:this.format(this.days().value),
              hours:this.format(this.hours().value),
              minutes:this.format(this.minutes().value),
              seconds:this.format(this.seconds().value),
            }
          },
        }
      }
    }" 
    x-show="!expired">
    <div 
      class="
        {% if section.settings.enable_margin %}
          {{ settings.x_margin }}
        {% endif %}
      "
      style="
        padding-top:{{ section.settings.spacing_top }}px;
        padding-bottom:{{ section.settings.spacing_bottom }}px;
      "
      x-init="init();"
      x-data="timer(new Date('{{ section.settings.countdown_date }}').getTime());">
      <div
        class="
          flex flex-wrap justify-between
          {% unless section.settings.enable_split %}
            {{ section.settings.layout_x_alignment }}
          {% endunless %}
          {% if section.settings.enable_split %}
            flex-row
          {% else %}
            flex-col
          {% endif %}
        ">

        {% comment %} Header {% endcomment %}
        <div 
          class="
            flex w-full flex-col
            {% if section.settings.enable_split %}
              md:w-1/3 md:pr-4 md:sticky md:top-4 md:self-start
            {% endif %}
            {% unless section.settings.enable_margin %}
              px-4
            {% endunless %}
          ">
          {% render 'component__section-header' %} 
        </div>
         
        {% comment %} Countdown {% endcomment %}
        <div 
          class="
            w-full h-auto max-w-prose
            {{ section.settings.layout_x_alignment }}
            {% if section.settings.enable_split %}md:w-2/3{% endif %}
            {% unless section.settings.enable_margin %}
              px-4
            {% endunless %}
          ">
          <div 
            class="flex items-center w-full gap-2">
            <div class="flex flex-col items-center justify-center w-full p-4 text-center color__bg-shade-2 border--radius">
              <span 
                class="opacity-50 type--smaller">{{ 'labels.days' | t }}
              </span>
              <span 
                class="type__heading-1 type__heading"
                x-text="time().days">00
              </span>
            </div>
            <div class="opacity-50">
              :
            </div>
            <div class="flex flex-col items-center justify-center w-full p-4 text-center color__bg-shade-2 border--radius">
              <span 
                class="opacity-50 type--smaller">{{ 'labels.hours' | t }}
              </span>
              <span 
                class="type__heading-1 type__heading"
                x-text="time().hours">00
              </span>
            </div>
            <div class="opacity-50">
              :
            </div>
            <div class="flex flex-col items-center justify-center w-full p-4 text-center color__bg-shade-2 border--radius">
              <span 
                class="opacity-50 type--smaller">{{ 'labels.minutes' | t }}
              </span>
              <span 
                class="type__heading-1 type__heading"
                x-text="time().minutes">00
              </span>
            </div>
            <div class="opacity-50">
              :
            </div>
            <div class="flex flex-col items-center justify-center w-full p-4 text-center color__bg-shade-2 border--radius">
              <span 
                class="opacity-50 type--smaller">{{ 'labels.seconds' | t }}
              </span>
              <span 
                class="type__heading-1 type__heading"
                x-text="time().seconds">00
              </span>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
{% endunless %}

{% schema %}
{
  "name":"t:sections.countdown.name",
  "settings":[
    {
      "type":"text",
      "id":"countdown_date",
      "label":"t:general.settings.countdown_date.label",
      "info":"t:general.settings.countdown_date.info"
    },
    {
      "type":"header",
      "content":"t:general.headers.content.content"
    },
    {
      "type":"text",
      "id":"heading",
      "label":"t:general.settings.heading.label"
    },
    {
      "type":"richtext",
      "id":"content",
      "label":"t:general.settings.content.label"
    },
    {
      "type":"text",
      "id":"button_label",
      "label":"t:general.settings.button_label.label"
    },
    {
      "type":"url",
      "id":"button_url",
      "label":"t:general.settings.button_url.label"
    },
    {
      "type": "header",
      "content": "t:general.headers.spacing.content"
    },
    {
      "type": "range",
      "id": "spacing_top",
      "min": 0,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "t:general.settings.top_spacing.label",
      "default": 100
    },
    {
      "type": "range",
      "id": "spacing_bottom",
      "min": 0,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "t:general.settings.bottom_spacing.label",
      "default": 100
    },
    {
      "type": "header",
      "content": "t:general.headers.color.content"
    },
    {
      "type":"select",
      "id":"color_scheme",
      "label":"t:general.settings.color_scheme.label",
      "options":[
        {
          "value":"color__bg-body color__text",
          "label":"t:general.settings.color_scheme.body.label"
        },
        {
          "value":"color__bg-neutral color__neutral",
          "label":"t:general.settings.color_scheme.neutral.label"
        },
        {
          "value":"color__bg-overlay-1 color__text",
          "label":"t:general.settings.color_scheme.accent_1.label"
        },
        {
          "value":"color__bg-overlay-2 color__text",
          "label":"t:general.settings.color_scheme.accent_2.label"
        },
        {
          "value":"color__bg-overlay-3 color__text",
          "label":"t:general.settings.color_scheme.accent_3.label"
        },
        {
          "value":"color__bg-shade-1 color__text",
          "label":"t:general.settings.color_scheme.shade_1.label"
        },
        {
          "value":"color__bg-shade-2 color__text",
          "label":"t:general.settings.color_scheme.shade_2.label"
        },
        {
          "value":"color__bg-shade-3 color__text",
          "label":"t:general.settings.color_scheme.shade_3.label"
        },
        {
          "value":"color__bg-primary color__primary",
          "label":"t:general.settings.color_scheme.primary.label"
        },
        {
          "value":"color__bg-secondary color__secondary",
          "label":"t:general.settings.color_scheme.secondary.label"
        },
        {
          "value":"color__bg-tertiary color__tertiary",
          "label":"t:general.settings.color_scheme.tertiary.label"
        }
      ],
      "default":"color__bg-body color__text"
    },
    {
      "type":"select",
      "id":"color_border",
      "label":"t:general.settings.color_border.label",
      "options":[
        {
          "value":"color__border-divider-1",
          "label":"t:general.settings.color_border.subtle.label"
        },
        {
          "value":"color__border-selected-1",
          "label":"t:general.settings.color_border.strong.label"
        }
      ],
      "default":"color__border-divider-1"
    },
    {
      "type":"select",
      "id":"color_button",
      "label":"t:general.settings.color_button.label",
      "options":[
        {
          "value":"btn",
          "label":"t:general.settings.color_button.primary.label"
        },
        {
          "value":"btn btn--secondary",
          "label":"t:general.settings.color_button.secondary.label"
        },
        {
          "value":"btn btn--tertiary",
          "label":"t:general.settings.color_button.tertiary.label"
        },
        {
          "value":"btn btn--neutral",
          "label":"t:general.settings.color_button.neutral.label"
        },
        {
          "value":"btn btn--plain",
          "label":"t:general.settings.color_button.plain.label"
        },
        {
          "value":"btn btn--outline",
          "label":"t:general.settings.color_button.outline.label"
        },
        {
          "value":"btn btn--outline-alt",
          "label":"t:general.settings.color_button.inverted_outline.label"
        },
        {
          "value":"btn btn--minimal",
          "label":"t:general.settings.color_button.link.label"
        },
        {
          "value":"btn btn--minimal-alt",
          "label":"t:general.settings.color_button.inverted_link.label"
        }
      ],
      "default":"btn btn--secondary"
    },
    {
      "type":"header",
      "content":"t:general.headers.style.content"
    },
    {
      "type":"select",
      "id":"style_border",
      "label":"t:general.settings.border_position.label",
      "options":[
        {
          "value":"",
          "label":"t:general.settings.border_position.none.label"
        },
        {
          "value":"border--t-width",
          "label":"t:general.settings.border_position.top.label"
        },
        {
          "value":"border--b-width",
          "label":"t:general.settings.border_position.bottom.label"
        },
        {
          "value":"border--b-width border--t-width",
          "label":"t:general.settings.border_position.top_and_bottom.label"
        }
      ],
      "default":"border--b-width"
    },
    {
      "type":"header",
      "content":"t:general.headers.layout.content"
    },
    {
      "type": "select",
      "id": "layout_x_alignment",
      "label": "t:general.settings.x_alignment.label",
      "options": [
        {
          "value": "justify-between",
          "label": "t:general.settings.x_alignment.left.label"
        },
        {
          "value": "text-center justify-center flex-col items-center",
          "label": "t:general.settings.x_alignment.center.label"
        },
        {
          "value": "text-right justify-end flex-col items-end",
          "label": "t:general.settings.x_alignment.right.label"
        }
      ],
      "default": "justify-between"
    },
    {
      "type":"checkbox",
      "id":"enable_margin",
      "label":"t:general.settings.enable_margin.label",
      "default":true
    },
    {
      "type":"checkbox",
      "id":"enable_split",
      "label":"t:general.settings.enable_split.label",
      "default":false
    },
    {
      "type":"header",
      "content":"t:general.headers.display.content"
    },
    {
      "type":"select",
      "id":"visibility",
      "label":"t:general.settings.visibility.label",
      "options":[
        {
          "value":"",
          "label":"t:general.settings.visibility.all.label"
        },
        {
          "value":"md:hidden",
          "label":"t:general.settings.visibility.mobile.label"
        },
        {
          "value":"hidden md:block",
          "label":"t:general.settings.visibility.desktop.label"
        }
      ],
      "default":""
    }
  ],
  "presets":[
    {
      "name":"t:sections.countdown.name",
      "settings": {
        "countdown_date": "10\/20\/2026",
        "heading": "Countdown",
        "content": "<p>Describe a product, make announcements, or welcome customers to your store.<\/p>",
        "button_label": "Button",
        "button_url": "shopify:\/\/collections\/all",
        "spacing_top": 100,
        "spacing_bottom": 100,
        "color_border": "color__border-divider-1",
        "color_button": "btn btn--secondary",
        "style_border": "border--b-width",
        "enable_margin": true,
        "enable_split": true,
        "visibility": ""
      }
    }
  ],
  "disabled_on": {
    "groups": ["custom.overlay"]
  }
}
{% endschema %}
