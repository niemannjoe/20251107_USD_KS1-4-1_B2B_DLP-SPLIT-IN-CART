<!-- sections/theme__announcement.liquid -->
{% comment %}
  Announcement bar at the top of the page.

  Globals:
    - layout_horizontal: {string}: Class string to set horizontal margin.
    - enable_animations: {boolean}: Global setting to determine if animations are enabled.
    - enable_language: {boolean}: Enable/disable the language selector
    - type_separator: {string}: This setting allows you to choose the type of separator between text.

  Recommendations:
    - Keep content here short and simple. Link to pages if you need to add more content.
{% endcomment %}

<section
  id="{{ section.id }}"
  class="
    animation-500--all relative overflow-hidden
    {{ section.settings.visibility }}
    {{ section.settings.color_scheme }}
  "
  x-data="
    {
      index: 1,
      index_size: {{ section.blocks.size }},
      width: '0%',
      currentWidth: 0,
      incrementCount: {{ section.settings.announcement_delay }}000 / 100,
      autoIncrement() {
        const incrementAmount = 100 / this.incrementCount;
        const startInterval = () => {
          const interval = setInterval(() => {
            this.currentWidth += incrementAmount;
            this.width = this.currentWidth + '%';
            if (this.currentWidth >= 100) {
              this.incrementFlash();
              clearInterval(interval);
              this.currentWidth = 0;
              this.width = this.currentWidth + '%';
              startInterval();
            }
          }, 100);
        };
        startInterval();
      },
      incrementFlash() {
        if (this.index == this.index_size){
          this.index = 1;
        }
        else {
          this.index++;
        }
      },
    }
  "
>
  <div
    class="
      flex flex-wrap justify-center
      {% if section.settings.enable_margin %}
        {{ settings.x_margin }}
      {% else %}
        window--full
      {% endif %}
    "
  >
    {% comment %} Announcement text {% endcomment %}
    <div
      class="
        flex w-full flex-grow items-center lg:w-1/2
        {% if section.settings.layout_alignment == "left" %}justify-start{% endif %}
        {% if section.settings.layout_alignment == "center" %}justify-center{% endif %}
      "
    >
      <div
        class="relative w-full"
        {% if section.settings.announcement_delay > 0 %}
          x-init="autoIncrement()"
        {% endif %}
      >
        <div class="relative flex min-h-[16px] w-full overflow-hidden py-1">
          {% for block in section.blocks %}
            <div
              class="
                flex w-full flex-none items-center opacity-0
                {% if section.settings.layout_alignment == "center" %}
                  justify-center text-center
                {% else %}
                  md:justify-start justify-center
                {% endif %}
                {% if settings.enable_animations %}
                  animation-300
                {% endif %}
              "
              :class="{ '!opacity-100' : index == {{ forloop.index }} }"
              x-show="index == {{ forloop.index }}"
              {% if settings.enable_animations %}
                x-transition:enter="animation-300"
                x-transition:enter-start="opacity-0 -translate-y-4"
                x-transition:enter-end="opacity-100"
                x-transition:leave="animation-300"
                x-transition:leave-start="opacity-100"
                x-transition:leave-end="opacity-0 translate-y-4"
              {% endif %}
            >
              {% comment %} Text content {% endcomment %}
              <span class="rte type--smaller">{{ block.settings.content }}</span>

              {% comment %} Arrow - if delay set to 0 {% endcomment %}
              {% if section.settings.announcement_delay == 0 %}
                <button
                  class="type--smaller ml-2 flex items-center !p-0 opacity-0"
                  :class="{ '!opacity-75' : index_size > 1 }"
                  title="{{ 'actions.next' | t }}"
                  x-show="index_size > 1"
                  {% if settings.enable_animations %}
                    x-transition:enter="animation-300"
                    x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100"
                    x-transition:leave="animation-300"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                  {% endif %}
                  @click="incrementFlash();"
                >
                  <span class="type--smaller" x-text="index"></span>
                  /
                  <span class="type--smaller" x-text="index_size"></span>
                  {% render 'component__icon', icon: 'chevron-right', size: '16', class: '' %}
                </button>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  {% comment %} Progress bar {% endcomment %}
  {% if section.settings.announcement_delay > 0 %}
    <div
      class="color__bg-text absolute left-0 right-0 top-0 h-0.5 w-full opacity-75 mix-blend-difference"
      x-init="        autoIncrement()"
    >
      <div class="color__bg-text">
        <div
          class="color__bg-body h-0.5 opacity-50 transition-all duration-100"
          :style="{ width: width }"
        ></div>
      </div>
    </div>
  {% endif %}
</section>

{% schema %}
{
  "name": "t:sections.theme_announcement.name",
  "class": "theme__announcement",
  "settings": [
    {
      "type": "range",
      "id": "announcement_delay",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "s",
      "label": "t:general.settings.auto_scroll_delay.label",
      "info": "t:general.settings.auto_scroll_delay.info",
      "default": 0
    },
    {
      "type": "header",
      "content": "t:general.headers.color.content"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "t:general.settings.color_scheme.label",
      "options": [
        {
          "value": "color__bg-body color__text",
          "label": "t:general.settings.color_scheme.body.label"
        },
        {
          "value": "color__bg-neutral color__text",
          "label": "t:general.settings.color_scheme.neutral.label"
        },
        {
          "value": "color__bg-overlay-1 color__text",
          "label": "t:general.settings.color_scheme.accent_1.label"
        },
        {
          "value": "color__bg-overlay-2 color__text",
          "label": "t:general.settings.color_scheme.accent_2.label"
        },
        {
          "value": "color__bg-overlay-3 color__text",
          "label": "t:general.settings.color_scheme.accent_3.label"
        },
        {
          "value": "color__bg-shade-1 color__text",
          "label": "t:general.settings.color_scheme.shade_1.label"
        },
        {
          "value": "color__bg-shade-2 color__text",
          "label": "t:general.settings.color_scheme.shade_2.label"
        },
        {
          "value": "color__bg-shade-3 color__text",
          "label": "t:general.settings.color_scheme.shade_3.label"
        },
        {
          "value": "color__bg-primary color__primary",
          "label": "t:general.settings.color_scheme.primary.label"
        },
        {
          "value": "color__bg-secondary color__secondary",
          "label": "t:general.settings.color_scheme.secondary.label"
        },
        {
          "value": "color__bg-tertiary color__tertiary",
          "label": "t:general.settings.color_scheme.tertiary.label"
        }
      ],
      "default": "color__bg-overlay-1 color__text"
    },
    {
      "type": "header",
      "content": "t:general.headers.layout.content"
    },
    {
      "type": "select",
      "id": "layout_alignment",
      "label": "t:general.settings.x_alignment.label",
      "options": [
        {
          "value": "left",
          "label": "t:general.settings.x_alignment.left.label"
        },
        {
          "value": "center",
          "label": "t:general.settings.x_alignment.center.label"
        }
      ],
      "default": "center"
    },
    {
      "type": "checkbox",
      "id": "enable_margin",
      "label": "t:general.settings.enable_margin.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:general.headers.display.content"
    },
    {
      "type": "select",
      "id": "visibility",
      "label": "t:general.settings.visibility.label",
      "options": [
        {
          "value": "",
          "label": "t:general.settings.visibility.all.label"
        },
        {
          "value": "md:hidden",
          "label": "t:general.settings.visibility.mobile.label"
        },
        {
          "value": "hidden md:block",
          "label": "t:general.settings.visibility.desktop.label"
        }
      ],
      "default": ""
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "t:sections.theme_announcement.blocks.announcement.name",
      "limit": 10,
      "settings": [
        {
          "type": "richtext",
          "id": "content",
          "label": "t:general.settings.content.label",
          "default": "t:general.defaults.short_placeholder"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["custom.overlay"]
  }
}
{% endschema %}
